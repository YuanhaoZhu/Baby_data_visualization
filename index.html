<html>
<head>
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
	<svg id="bubbleGraph" height="900" width="800" style="background: #sff; " ></svg>

  <script>
  	const bubbleLayer = d3.select("#bubbleGraph").append("g");
  	const bubbleLegend = d3.select("#bubbleGraph").append("g");

    const bubbleWidth = d3.select("#bubbleGraph").attr("width");
    const bubbleHeight = d3.select("#bubbleGraph").attr("height");
    const bubblePadding = 50
    const bubblePaddedHeight = bubbleHeight - 2*bubblePadding
    const bubblePaddedWidth = bubbleWidth - 2*bubblePadding

    const requestData = async () => {
      const bbnames = await d3.csv("Popular_Baby_Names.csv")
      console.log(bbnames)



      nameBubbleData = bbnames.filter((d)=>{return d["Rank"] <= 50 && d["Year of Birth"] === "2015";});

      console.log(nameBubbleData)

      const rankExtent = d3.extent(nameBubbleData, d => d['Rank']);
      const rankScale = d3.scaleLinear().domain(rankExtent).range([bubblePadding, bubblePaddedHeight]);

      const colorScale = d3.scaleOrdinal()
                           .domain(["WHITE NON HISPANIC","HISPANIC","BLACK NON HISPANIC","ASIAN AND PACIFIC ISLANDER"])
                           .range(["#FEF1E2","#E28E51","#50280D","#FDDEBB"]);



      // Construct a d3.forceSimulation model for your network diagram.
      var sim = d3.forceSimulation()
                  .nodes(nameBubbleData)
                  // .force("links", d3.forceLink()
                  //                         .links(edges)
                  //                         .id( d => d['icpsr'] ) )
                  // .force("repulse", d3.forceManyBody().strength(-150) )
                  .force("ypos", d3.forceY().y(d => rankScale(d.Rank)).strength( 0.8 ) )//y-positioning force, set less than 1.0
                  .force("xpos", d3.forceX().x( d=> {
                    if (d["Ethnicity"] === "WHITE NON HISPANIC"){return bubblePaddedWidth*0.25}
                    if (d["Ethnicity"] === "HISPANIC"){return bubblePaddedWidth*0.5}
                    if (d["Ethnicity"] === "BLACK NON HISPANIC"){return bubblePaddedWidth*0.75}
                    if (d["Ethnicity"] === "ASIAN AND PACIFIC ISLANDER"){return bubblePaddedWidth}
                    else {return 0}}).strength( 0.8 ) )
                  .force("collision", d3.forceCollide()
                                                       .radius(28)
                                                       .iterations(2) )
                  .on("tick", render);


      // Update the chart for a new tick of the simulation
      function render() {

        // Edges
        // let lines = bubbleLayer.selectAll("line.link").data(edges)
        //      .join(
        //        enter => enter.append("line")
        //                      .attr("class","link")
        //                      .attr("stroke","#333")
        //      )
        //      .attr("x1", d => d.source.x).attr("x2", d => d.target.x)
        //      .attr("y1", d => d.source.y).attr("y2", d => d.target.y);

        // Nodes
        let circles = bubbleLayer.selectAll("circle.node").data(nameBubbleData)
               .join(
                  enter => enter.append("circle")
                                .attr("class","node")
                                .attr("stroke", "pink")
                                .attr("stroke-width", 5)
                                .attr("stroke-alignment","outer")
                                .attr("r", 26)
                                .attr("cx", 0)
                                .attr("cy", 0)
                                .attr("fill", d => colorScale(d.Ethnicity))
                                // .call( d3.drag().on("start",dragstart)
                                //                 .on("drag",dragging)
                                //                 .on("end",dragend) )
                )
               .attr("transform", d => `translate(${d.x},${d.y})`);

            let texts = bubbleLayer.selectAll(null)
                   .data(nameBubbleData)
                   .join(
                        enter=>enter.append('text')
                        .text(function(d){return d["Child's First name"]})
                        .attr('fill', 'black')
                        .attr('font-size', 15)
                      )
                  .attr("transform",d=>`translate(${d.x},${d.y})`);




               //.attr("transform", d => `translate(${d.x},${d.y})`);






      }

    }
    requestData()
  </script>
</body>
</html>
